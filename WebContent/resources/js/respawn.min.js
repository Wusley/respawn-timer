$(".background img").hisrc({minwidth:1280});window.onload=function(){new background(document.body.clientWidth);new addFormRespawn();new getListRespawn();$("section.conexao").css("margin-top",document.body.clientHeight/2-140)};$(window).resize(function(){new background(document.body.clientWidth);$("section.conexao").css("margin-top",document.body.clientHeight/2-140)});$(window).mousemove(function(e){new parallax(e)});$(".conectar").click(function(){$(".container-conexao").css({display:"table"});$("form[name='form-conexao']").find("input[name='email']").focus()});$("section.conexao img.fechar").click(function(){$(".container-conexao").css({display:"none"})});$("form[name='form-registro']").find("input[type='button']").click(function(){new efeitoTransicaoON();var form=$(this).parents("form"),data=form.serialize();$.ajax({type:"POST",url:form.attr("action"),dataType:"json",data:data,cache:false,statusCode:{200:function(data){new efeitoTransicaoOFF();if(!data.errors){$(".container-conexao").css({display:"none"});var url=window.location.toString();if(url.indexOf("respawn/")>0){window.history.pushState(null,null,data.nick)}else{if(url.indexOf("respawn")>0){window.history.pushState(null,null,"respawn/"+data.nick)}}$("li.conectar").remove();$("li.conectar-hidden").css({display:"inline"}).find(".nick-conectado").text(data.nick);new insertSuccess("Sucesso ao realizar o cadastro.");new efeitoTransicao(".sucesso")}else{new insertListaErrors(data.errors);new efeitoTransicao(".falha")}}}})});$("form[name='form-conexao']").find("input[type='button']").click(function(){new efeitoTransicaoON();var form=$(this).parents("form"),data=form.serialize();$.ajax({type:"POST",url:form.attr("action"),dataType:"json",data:data,cache:false,statusCode:{401:function(){$(".container-conexao").css({display:"block"})},200:function(data){new efeitoTransicaoOFF();if(data===null||data===undefined||data===""){new insertError("Senha incorreta.");new efeitoTransicao(".erro")}else{if(!data.errors){$(".container-conexao").css({display:"none"});var url=window.location.toString();if(url.indexOf("respawn/")>0){window.history.pushState(null,null,data.nick)}else{if(url.indexOf("respawn")>0){window.history.pushState(null,null,"respawn/"+data.nick)}}$("li.conectar").remove();$("li.conectar-hidden").css({display:"inline"}).find(".nick-conectado").text(data.nick);new getListRespawn();new insertSuccess("Conectado com sucesso.");new efeitoTransicao(".sucesso")}else{if(data.errors){new insertListaErrors(data.errors);new efeitoTransicao(".falha")}}}}}})});$("form[name='form-respawn']").find("input[name='remover']").die();$("form[name='form-respawn']").find("input[name='remover']").live("click",function(){$(this).parents("li").remove();new fixedRespawn()});$(".novo-formulario-respawn").click(function(){new addFormRespawn()});$("form[name='form-respawn']").find("input[name='iniciar']").die();$("form[name='form-respawn']").find("input[name='iniciar']").live("click",function(){new efeitoTransicaoON();var that=$(this);var form=that.parents("form");var dataMorte=validaDate(form.find("input[name='dataMorte']").val());var tempoNascimento=validaDate("1970/1/1 "+form.find("input[name='tempoNascimento']").val()+":0");var dias=validaNumero(form.find("input[name='dias']").val());var dataMorte=Date.parse(new Date(dataMorte));var GMTNascimento=new Date(tempoNascimento).getTimezoneOffset()*60000;var tempoNascimento=Date.parse(new Date(tempoNascimento))-GMTNascimento;$.ajax({type:"POST",url:form.attr("action"),dataType:"json",data:{nome:form.find("input[name='nome']").val(),dataMorte:dataMorte,dias:dias,tempoNascimento:tempoNascimento},cache:false,statusCode:{401:function(){new efeitoTransicaoOFF();$(".container-conexao").css({display:"block"});$("form[name='form-conexao']").find("input[name='email']").focus()},200:function(data){new efeitoTransicaoOFF();if(!data.errors){that.parents("li").remove();new fixedRespawn();new polimorfRespawnFactory(data.respawn,"one");new insertSuccess("Sucesso ao registrar o respawn.");new efeitoTransicao(".sucesso")}else{new insertListaErrors(data.errors);new efeitoTransicao(".falha")}}}})});$("input[name='dataMorte']").die();$("input[name='dataMorte']").live("click",function(){$("form[name='form-respawn']").each(function(){$(this).find("input[name='dataMorte']").attr("id","calendario-off")});$(this).attr("id","calendario-on");new calendario("#calendario-on")});$("input[name='tempoNascimento']").die();$("input[name='tempoNascimento']").live("click",function(){$("form[name='form-respawn']").each(function(){$(this).find("input[name='tempoNascimento']").attr("id","relogio-off")});$(this).attr("id","relogio-on");new relogio("#relogio-on")});var getListRespawn=function(){var url=window.location.toString().split("/");var posicao=url.indexOf("respawn")+1;if(posicao>1&&posicao<url.length&&url[posicao]!=""&&url.indexOf("respawn")>0){$.ajax({type:"POST",url:url[posicao],cache:false,statusCode:{200:function(data){if(data!==null&&data!==undefined&&data!==""){console.log(data);new polimorfRespawnFactory(data.list,"many")}}}})}};$("form[name='view-respawn'] input[type='button']").die();$("form[name='view-respawn'] input[type='button']").live("click",function(){new efeitoTransicaoON();var that=$(this);var form=that.parents("form");var now=new Date();var GMT=now.getTimezoneOffset()*60000;$.ajax({type:"POST",url:form.attr("action"),dataType:"json",data:{id:form.find("input[name='id']").val(),acao:that.attr("name"),now:now.getTime(),gmt:GMT},cache:false,statusCode:{401:function(){new efeitoTransicaoOFF();$(".container-conexao").css({display:"block"})},200:function(data){new efeitoTransicaoOFF();new finalizaRespawn(data,that)}},})});$(".alertas section img.fechar").click(function(){$(".alertas section article").animate({height:"0px"},300,function(){$(".alertas section article").css({display:"none",height:"auto"});clearTimeout(animation)})});$("footer.social a").mouseover(function(){$("button."+$(this).attr("class")).addClass("hover")});$("footer.social a").mouseout(function(){$("button."+$(this).attr("class")).removeClass("hover")});var cSpeed=5;var cWidth=110;var cHeight=64;var cTotalFrames=10;var cFrameWidth=110;var cImageTimeout=false;var cIndex=0;var cXpos=0;var SECONDS_BETWEEN_FRAMES=0;var animation;function startAnimation(){clearTimeout(animation);animation=0;cImageTimeout=setTimeout(function(){document.getElementById("loaderImage").style.width=cWidth+"px";document.getElementById("loaderImage").style.height=cHeight+"px";FPS=Math.round(100/cSpeed);SECONDS_BETWEEN_FRAMES=1/FPS;animation=setTimeout("continueAnimation()",SECONDS_BETWEEN_FRAMES/1000)},0)}function continueAnimation(){cXpos+=cFrameWidth;cIndex+=1;if(cIndex>=cTotalFrames){cXpos=0;cIndex=0}document.getElementById("loaderImage").style.backgroundPosition=(-cXpos)+"px 0";animation=setTimeout("continueAnimation()",SECONDS_BETWEEN_FRAMES*1000)}var parallax=function(e){$(".background").css({"margin-top":Math.round(e.pageY*0.1)*(-1),"margin-left":Math.round(e.pageX*0.1)*(-1)});$(".nuvem1").css({"margin-top":Math.round(e.pageY*0.2)*(-1),"margin-left":Math.round(e.pageX*0.2)*(-1)});$(".nuvem2").css({"margin-top":Math.round(e.pageY*0.4)*(-1),"margin-left":Math.round(e.pageX*0.4)*(-1)});$(".nuvem3").css({"margin-top":Math.round(e.pageY*0.6)*(-1),"margin-left":Math.round(e.pageX*0.6)*(-1)})};var background=function(w){var width=w;$(".cidade").css({width:width*1.2});$(".nuvem").css({width:width*1.3});var cidadeHeight=$(".cidade").height();$(".parallax-viewport").css({width:width,height:cidadeHeight});$(".cidade").css({"margin-top":(cidadeHeight*0.25)*(-1),"margin-left":((width*1.2)/2)*(-1)})};var respawns={};var ping;var polimorfRespawnFactory=function(data,call){clearTimeout(ping);var count=0;for(id in respawns){count++}if(count<=0){$(".lista-respawn ul").html("")}var modelo=$(".box-lista-respawn .modelo").html();switch(call){case"one":new respawnFactory(data,modelo);break;case"many":new listRespawnFactory(data,modelo);break}ping=window.setInterval("regressivo()",1000)};var respawnFactory=function(data,modelo){var nascimento=new Nascimento();$(".lista-respawn ul").append(modelo);if(data!==null&&data!==undefined&&data!==""){$(".lista-respawn #respawn").attr("id",data.id).find("input[name='id']").val(data.id);$("#"+data.id).find(".nome").text(data.nome);$("#"+data.id).find(".tempoNascimento").text(formataTempoNascimento(nascimento.tempoNascimento(data.tempoNascimento)));$("#"+data.id).find(".nascimento").text(formataDataNascimento(nascimento.dataNascimento(data.dataMorte,data.tempoNascimento)));$("#"+data.id).find("input[name='delete']").attr("disabled",false);respawns[data.id]={id:data.id,dataNascimento:nascimento.dataNascimento(data.dataMorte,data.tempoNascimento)}}};var listRespawnFactory=function(data,modelo){$(".lista-respawn ul").html("");for(id in data){new respawnFactory(data[id],modelo)}};var regressivo=function(){var agora=new Date();var count=0;for(id in respawns){count++;if(!breakRespawn(respawns[id])){var segundo=parseInt(((respawns[id].dataNascimento-agora)+60000)/1000);var minuto=parseInt(segundo/60);var hora=parseInt(minuto/60);var dia=parseInt(hora/24);minuto=minuto-(hora*60);hora=hora-(dia*24);if(hora<=9){hora="0"+hora}if(minuto<=9){minuto="0"+minuto}var formato="";formato+=(dia&&dia>1)?dia+" dias, ":(dia===1?"1 dia, ":"");formato+=(toString(hora).length)?hora+":":"";formato+=(toString(minuto).length)?minuto:"";$("#"+respawns[id].id).find(".regressiva").text(formato)}}if(count<=0){clearTimeout(ping);respawnDefault()}};var respawnDefault=function(){var count=0;for(id in respawns){count++}if(count<=0){var modelo=$(".box-lista-respawn .modelo").html();$(".lista-respawn ul").html(modelo)}};var finalizaRespawn=function(data,that){switch(data.status){case true:switch(that.attr("name")){case"sucesso":new insertError("N&atilde;o foi poss&iacute;vel declarar sucesso no respawn, pois ainda n&atilde;o ocorreu o respawn.");break;case"falha":new insertError("N&atilde;o foi poss&iacute;vel declarar falha no respawn, pois ainda n&atilde;o ocorreu o respawn.");break;case"delete":new insertError("N&atilde;o foi poss&iacute;vel cancelar o respawn, pois o tempo de nascimento j&iacute; ocorreu e deve ser declarado sucesso ou falha.");break}new efeitoTransicao(".erro");break;case false:that.parents("li").remove();delete respawns[data.id];new respawnDefault();switch(data.sucesso){case 0:new insertSuccess("Respawn perdido.");break;case 1:new insertSuccess("Respawn conclu&iacute;do.");break;case 2:new insertSuccess("Respawn cancelado.");break}new efeitoTransicao(".sucesso");break}};var breakRespawn=function(data){var agora=new Date().getTime();if(agora>=data.dataNascimento.getTime()){$("#"+data.id).parents("li").addClass("active");$("#"+data.id).find(".regressiva").text("00:00");$("#"+data.id).find("input[type='button']").attr("disabled",false);$("#"+data.id).find("input[name='delete']").attr("disabled",true);return true}return false};var formataTempoNascimento=function(tempoNascimento){var segundo=parseInt(tempoNascimento/1000);var minuto=parseInt(segundo/60);var hora=parseInt(minuto/60);var dia=parseInt(hora/24);minuto=minuto-(hora*60);hora=hora-(dia*24);if(hora<=9){hora="0"+hora}if(minuto<=9){minuto="0"+minuto}var formato="";formato+=(dia&&dia>1)?dia+" dias, ":(dia==1?"1 dia, ":"");formato+=(toString(hora).length)?hora+":":"";formato+=(toString(minuto).length)?minuto:"";return formato};var formataDataNascimento=function(dataNascimento){var ano=dataNascimento.getFullYear();var mes=dataNascimento.getMonth()+1;var dia=dataNascimento.getDate();var hora=dataNascimento.getHours();var minuto=dataNascimento.getMinutes();if(dia<=9){dia="0"+dia}if(mes<=9){mes="0"+mes}if(hora<=9){hora="0"+hora}if(minuto<=9){minuto="0"+minuto}var formato=dia+"/"+mes+"/"+ano+" "+hora+":"+minuto;return formato};var Nascimento=function(){return{tempoNascimento:function(tempoNascimento){return new Date(tempoNascimento)},dataNascimento:function(dataMorte,tempoNascimento){return new Date(dataMorte+tempoNascimento)}}};var calendario=function(data){$(data).datetimepicker({})},relogio=function(data){$(data).timepicker()};var fixedRespawn=function(){var forms=$(".formularios-respawn ul").find("li").size();if(forms<=0){new addFormRespawn()}};var addFormRespawn=function(){var formRespawn=$(".box-formularios-respawn .modelo").html();$(".formularios-respawn ul").append(formRespawn);$(".formularios-respawn ul").find("li:last").find("input[name='dataMorte']").trigger("click",function(){$(this).attr("id","calendario-on");new calendario("#calendario-on")});$(".formularios-respawn ul").find("li:last").find("input[name='tempoNascimento']").trigger("click",function(){$(this).attr("id","relogio-on");new relogio("#relogio-on")})};var validaDate=function(data){if(new Date(data).getTime()){return data}else{return -1}};var validaNumero=function(data){var er=/\D/g;if(!er.test(data)&&data.length>0){return data}else{if(data.length===0){return 0}else{return -1}}};var insertSuccess=function(data){$(".sucesso h3").html(data)};var insertError=function(data){$(".erro h3").html(data)};var insertListaErrors=function(data){$(".falha .falhas").html("");for(id in data){var falha=$("<p />").html(data[id]);$(".falha .falhas").append(falha)}};var pingTransicao;var efeitoTransicao=function(path){clearTimeout(pingTransicao);$(".alertas section article").css({display:"none",height:"auto"});var altura=$(path).height();$(path).css({display:"block",height:"0px"});$(path).animate({height:altura},300);pingTransicao=window.setTimeout("transicao('"+path+"')",5000)};var transicao=function(path){$(path).animate({height:"0px"},300,function(){$(path).css({display:"none",height:"auto"})})};var efeitoTransicaoON=function(){var path=".loading";$(".alertas section article").css({display:"none",height:"auto"});var altura=$(path).height();$(path).css({display:"block",height:"0px"});new startAnimation();$(path).animate({height:altura},300)};var efeitoTransicaoOFF=function(){var path=".loading";$(path).animate({height:"0px"},300,function(){$(path).css({display:"none",height:"auto"});clearTimeout(animation)})};